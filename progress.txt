# Progress Notes - In DO Time

## Iteration 1 - Scaffold Next.js project with TailwindCSS and App Router
- What was implemented:
  - Scaffolded Next.js 16.1.6 with App Router and TypeScript
  - TailwindCSS 4.x configured with PostCSS
  - ESLint configured for Next.js
  - Source files in `src/` directory with `@/*` import alias
  - Moved DO Code Lab logo to `public/DO_CODE_LAB_LOGO_NO_TEXT.png`
- Files changed:
  - Created standard Next.js project structure
  - package.json (name: "in-do-time")
  - src/app/layout.tsx, page.tsx, globals.css
  - tsconfig.json, next.config.ts, tailwind.config.ts
  - postcss.config.mjs, eslint.config.mjs
- Learnings for future iterations:
  - Next.js 16 uses TailwindCSS v4 with new PostCSS plugin (@tailwindcss/postcss)
  - React 19 is bundled with Next.js 16
  - create-next-app doesn't allow spaces or caps in project names - must use subdirectory approach
  - Logo placed at public/DO_CODE_LAB_LOGO_NO_TEXT.png as specified in PRD
---

## Iteration 2 - Set up Supabase client and environment variables
- What was implemented:
  - Created .env.example with Supabase URL and anon key template
  - Created .env.local for local development (gitignored)
  - Created src/lib/supabase.ts with typed Supabase client
  - Created src/types/database.ts with full TypeScript types matching PRD schema
  - Updated .gitignore to track .env.example but ignore .env.local
- Files changed:
  - .env.example (new)
  - .env.local (new, gitignored)
  - src/lib/supabase.ts (new)
  - src/types/database.ts (new)
  - .gitignore (updated)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - @supabase/supabase-js was already installed in package.json
  - Database types include Row, Insert, Update variants for each table
  - Convenience types (Client, Project, TimeEntry) exported for easier use
  - Next.js build confirms .env.local is loaded (shows "Environments: .env.local")
---

## Iteration 3 - Run database schema migration (create all 3 tables + indexes)
- What was implemented:
  - Created supabase/migrations/001_initial_schema.sql with full schema
  - All 3 tables: clients, projects, time_entries
  - All 3 indexes: idx_time_entries_project, idx_time_entries_start, idx_projects_client
  - Added updated_at triggers for automatic timestamp updates
  - Enabled RLS with permissive policies (single-user MVP, no auth)
  - Created supabase/README.md with setup instructions
- Files changed:
  - supabase/migrations/001_initial_schema.sql (new)
  - supabase/README.md (new)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Migration file uses IF NOT EXISTS for idempotent runs
  - RLS must be enabled with permissive policies for anon access
  - Migration is meant to be run in Supabase SQL Editor (not automated CLI)
  - Build and lint pass - project remains in healthy state
---

## Iteration 4 - Place DO Code Lab logo in public/ and generate favicon
- What was implemented:
  - Logo already existed at public/DO_CODE_LAB_LOGO_NO_TEXT.png (from iteration 1)
  - Generated 32x32 icon.png from logo using macOS sips
  - Generated 180x180 apple-icon.png for Apple touch devices
  - Removed default favicon.ico
  - Updated layout.tsx metadata title to "In DO Time"
  - Updated layout.tsx metadata description to "Multi-client time tracking for DO Code Lab"
- Files changed:
  - src/app/icon.png (new - generated from logo)
  - src/app/apple-icon.png (new - generated from logo)
  - src/app/favicon.ico (deleted)
  - src/app/layout.tsx (updated metadata)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Next.js App Router auto-detects icon.png and apple-icon.png in app/ directory
  - macOS sips is available for image conversion when ImageMagick isn't installed
  - Build output shows /icon.png and /apple-icon.png as static routes when properly placed
  - Favicon should be in app/ dir not public/ for App Router convention
---

## Iteration 5 - Create app layout with branded header (logo + "In DO Time" + nav)
- What was implemented:
  - Updated globals.css with DO Code Lab brand colors using TailwindCSS v4 @theme inline
  - Configured all brand colors: primary, primary-dark, primary-light, surface, accent, text, border, etc.
  - Added design tokens for border radius (button: 8px, card: 12px) and card shadows
  - Created Header component with DO Code Lab logo (40px), "In DO Time" title, and nav links
  - Navigation includes: Dashboard, Time Log, Reports, Clients with active state styling
  - Updated layout.tsx to use Playfair Display (headings) and Inter (body) fonts from Google Fonts
  - Layout includes Header component and main content area with max-w-7xl container
  - Updated page.tsx with simple placeholder using brand styling
- Files changed:
  - src/app/globals.css (updated with brand colors and design tokens)
  - src/components/Header.tsx (new)
  - src/app/layout.tsx (updated with fonts and Header)
  - src/app/page.tsx (updated with placeholder content)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - TailwindCSS v4 uses @theme inline block for custom CSS variables
  - Font variables are set via next/font/google and consumed in CSS via var(--font-name)
  - Header uses 'use client' for usePathname hook to highlight active nav item
  - Brand colors accessible as Tailwind classes like bg-primary, text-primary-dark, etc.
  - Components go in src/components/ directory with @/components/* imports
---

## Iteration 6 - Build Client CRUD (add, edit, archive clients with name, hourly rate, color)
- What was implemented:
  - Created /clients page with full CRUD functionality
  - List view shows all active clients in card-based grid layout (3 columns desktop, responsive)
  - Each card displays: name, hourly rate, color indicator, edit/archive buttons
  - Add client modal with form: name (required), hourly rate, color picker (8 preset colors)
  - Edit client functionality reuses same modal
  - Archive/restore functionality with confirmation dialog
  - Toggle to show/hide archived clients
  - Error handling with user-friendly messages
  - Loading states during data fetch
- Files changed:
  - src/app/clients/page.tsx (new - full Client CRUD page)
  - src/types/database.ts (updated - added Relationships property for Supabase SDK v2 compatibility)
  - src/lib/supabase.ts (updated - lazy initialization pattern to avoid build-time errors)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Supabase SDK v2 requires Relationships property in each table definition for TypeScript
  - Supabase client must use lazy initialization to avoid build errors when env vars missing
  - ESLint rule react-hooks/set-state-in-effect is VERY strict - cannot call setState synchronously in useEffect body
  - Workaround: call setState only in .then() callbacks or event handlers, not at effect start
  - Use refreshTrigger pattern to trigger re-fetches: increment counter + add to useEffect deps
  - Client colors stored as hex strings in database, rendered with inline styles
---

## Iteration 7 - Build Project CRUD (add, edit, archive projects under clients with optional rate override)
- What was implemented:
  - Created /projects page with full CRUD functionality
  - List view shows all projects in card-based grid layout with client color border
  - Each card displays: project name, client name, effective hourly rate, edit/archive buttons
  - Add project modal with form: client selection (dropdown), name, optional hourly rate override
  - Edit project functionality reuses same modal
  - Archive/restore functionality with confirmation dialog
  - Toggle to show/hide archived projects
  - Shows warning when no clients exist (can't create projects without a client)
  - Displays "(override)" indicator when project uses custom rate vs client rate
  - Added Projects link to Header navigation
- Files changed:
  - src/app/projects/page.tsx (new - full Project CRUD page)
  - src/components/Header.tsx (updated - added Projects nav link)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Supabase select with relations: `.select('*, clients(id, name, color, hourly_rate)')`
  - Relations come back as nested object (project.clients.name)
  - Use Promise.all to load multiple resources (projects + clients) in parallel
  - getEffectiveRate helper function determines if override or client rate applies
  - Disable "Add Project" button when no clients exist (required foreign key)
---

## Iteration 8 - Create timer engine: start timer → creates time_entry with is_running=true
- What was implemented:
  - Created src/lib/timer.ts with core timer engine functions
  - startTimer(projectId, notes?) → creates time_entry with is_running=true, start_time=now
  - getRunningTimers() → fetches all time entries where is_running=true
  - getRunningTimerForProject(projectId) → get running timer for specific project
  - hasRunningTimer(projectId) → boolean check if project has running timer
  - Helper utilities: calculateElapsedSeconds, formatDuration, calculateRunningCost, formatCurrency
- Files changed:
  - src/lib/timer.ts (new - timer engine core)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Timer engine is a pure TypeScript lib file (not a React component)
  - Uses getSupabase() pattern for lazy client initialization
  - TimeEntryInsert type matches database schema exactly
  - PGRST116 error code means "no rows found" - expected when checking for running timers
  - formatDuration returns HH:MM:SS format, padded with zeros
  - Timer state persists in Supabase - can survive browser refresh
---

## Iteration 9 - Stop timer → sets end_time, calculates duration_seconds, sets is_running=false
- What was implemented:
  - Added stopTimer(timeEntryId) function to timer engine
  - Fetches current entry to verify it exists and is_running=true
  - Calculates duration_seconds using existing calculateElapsedSeconds helper
  - Updates entry with end_time (ISO string), duration_seconds, is_running=false
  - Added convenience function stopTimerForProject(projectId) that finds and stops the running timer
  - Both functions return TimerResult with success/error states
- Files changed:
  - src/lib/timer.ts (added stopTimer and stopTimerForProject functions)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Stop timer must first fetch entry to get start_time for duration calculation
  - Validation checks: entry must exist AND is_running must be true
  - Two stop variants: by timeEntryId (direct) and by projectId (convenience)
  - Pattern: fetch first, validate, then update - prevents race conditions
---

## Iteration 10 - Pause/resume functionality (stop current entry, start new one on resume)
- What was implemented:
  - Added pauseTimer(projectId) → delegates to stopTimerForProject (stops current entry)
  - Added resumeTimer(projectId, copyNotes?) → starts new entry, optionally copies notes from last entry
  - Added getLastEntryForProject(projectId) → gets most recent entry for a project
  - Added getPausedTimerForProject(projectId) → checks if project has a "paused" state (stopped within 24h)
  - Added getTimerStateForProject(projectId) → returns 'running' | 'paused' | 'stopped' with entry
  - Added TimerState type export
- Files changed:
  - src/lib/timer.ts (added 5 new functions + 1 type)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Pause is semantically distinct from stop, but uses same underlying mechanism
  - "Paused" state determined by having a stopped entry within 24 hours
  - copyNotes=true by default on resume to continue work context
  - TimerState type enables UI to show different button states per project
  - Pattern: pause/resume creates separate time entries (not a single paused entry)
---

## Iteration 11 - Support multiple simultaneous running timers (one per project)
- What was implemented:
  - Added validation to startTimer() to prevent multiple running timers per project
  - startTimer now checks getRunningTimerForProject() before creating new entry
  - Added RunningTimerWithProject interface for dashboard display
  - Added getAllRunningTimersWithProjects() - fetches all running timers with nested project + client data
  - Added getRunningTimerCount() - quick count for dashboard indicators
  - Uses Supabase nested select: time_entries → projects → clients
  - Returns effectiveRate (project override or client rate) for each running timer
- Files changed:
  - src/lib/timer.ts (added validation to startTimer, added 3 new exports)
  - PRD.md (marked task complete)
- Learnings for future iterations:
  - Multiple simultaneous timers already worked via getRunningTimers() returning all
  - Key constraint "one per project" enforced by validation in startTimer and resumeTimer
  - Supabase nested joins: `projects!inner(..., clients!inner(...))` for multi-level relations
  - eslint @typescript-eslint/no-explicit-any needed for complex Supabase return types
  - RunningTimerWithProject provides dashboard-ready structure with effectiveRate pre-calculated
---
